<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Калькулятор стоимости - Reffection</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Onest:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Onest', -apple-system, BlinkMacSystemFont, sans-serif;
            background: radial-gradient(79.19% 22.8% at 79.19% 22.8%, #05A6F5 4.21%, #0168C7 26.06%, #034090 44.49%, #01193B 82.21%, #00040D 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }

        .background-blur {
            position: absolute;
            top: 460px;
            left: 0;
            width: 1680px;
            height: 1090px;
            background: #074398;
            filter: blur(300px);
            z-index: 0;
        }

        .calculator-container {
            position: relative;
            width: 1280px;
            height: 817px;
            border-radius: 10px;
            margin: 0 auto;
            z-index: 1;
        }

        .header {
            position: absolute;
            left: 50px;
            top: 40px;
            width: 481px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .header h1 {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 36px;
            line-height: 1.17;
            letter-spacing: -2%;
            color: #FFFFFF;
            margin: 0;
        }

        .header p {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 16px;
            line-height: 1.5;
            letter-spacing: 2%;
            color: #FFFFFF;
            margin: 0;
        }

        .product-section {
            position: absolute;
            left: 50px;
            top: 184px;
            width: 360px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section-title {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 14px;
            line-height: 1.57;
            letter-spacing: 2%;
            color: #FFFFFF;
        }

        .product-selector {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            backdrop-filter: blur(150px);
            box-shadow: inset 0px 0px 50px 0px rgba(255, 255, 255, 0.2);
            gap: 14px;
            cursor: pointer;
        }

        .product-name {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 18px;
            line-height: 1.44;
            letter-spacing: 2%;
            color: #FFFFFF;
            flex: 1;
        }

        .dropdown-arrow {
            width: 12px;
            height: 6px;
            stroke: #FFFFFF;
            stroke-width: 2px;
            transition: transform 0.3s ease;
        }

        .dropdown-arrow.open {
            transform: rotate(180deg);
        }

        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: radial-gradient(79.19% 22.8% at 79.19% 22.8%, rgba(5, 166, 245, 0.9) 4.21%, rgba(1, 104, 199, 0.9) 26.06%, rgba(3, 64, 144, 0.9) 44.49%, rgba(1, 25, 59, 0.9) 82.21%, rgba(0, 4, 13, 0.9) 100%);
            border: 1px solid #494949;
            border-radius: 20px;
            backdrop-filter: blur(100px);
            z-index: 10;
            margin-top: 8px;
            overflow: hidden;
        }

        .dropdown-item {
            padding: 20px 30px;
            font-family: 'Onest';
            font-weight: 400;
            font-size: 20px;
            line-height: 1.5;
            letter-spacing: 2%;
            color: #FFFFFF;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .dropdown-item.selected {
            background: rgba(5, 166, 245, 0.2);
        }

        .average-check-section {
            position: absolute;
            left: 50px;
            top: 332px;
            width: 770px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .input-container {
            position: relative;
            display: flex;
            align-items: center;
            padding: 20px 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            backdrop-filter: blur(150px);
            box-shadow: inset 0px 0px 50px 0px rgba(255, 255, 255, 0.2);
            height: 66px;
        }

        .input-placeholder {
            position: absolute;
            left: 36px;
            top: 30px;
            width: 300px;
            height: 30px;
            font-family: 'Onest';
            font-weight: 400;
            font-size: 20px;
            line-height: 1.5;
            letter-spacing: 2%;
            color: rgba(255, 255, 255, 0.5);
            pointer-events: none;
        }

        .input-field {
            background: transparent;
            border: none;
            outline: none;
            color: #FFFFFF;
            font-family: 'Onest';
            font-weight: 400;
            font-size: 18px;
            line-height: 1.44;
            letter-spacing: 2%;
            width: 100%;
            padding: 0;
        }

        .input-field::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .disclaimer {
            position: absolute;
            left: 870px;
            top: 40px;
            width: 360px;
            height: 66px;
            font-family: 'Onest';
            font-weight: 400;
            font-size: 14px;
            line-height: 1.57;
            letter-spacing: 2%;
            color: #FFFFFF;
        }

        
        .subscription-section {
            position: absolute;
            left: 460px;
            top: 184px;
            width: 360px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .subscription-selector {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            backdrop-filter: blur(150px);
            box-shadow: inset 0px 0px 50px 0px rgba(255, 255, 255, 0.2);
            height: 66px;
            cursor: pointer;
        }

        .subscription-value {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 18px;
            line-height: 1.44;
            letter-spacing: 2%;
            color: #FFFFFF;
            flex: 1;
        }

        .subscription-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: radial-gradient(79.19% 22.8% at 79.19% 22.8%, rgba(5, 166, 245, 0.9) 4.21%, rgba(1, 104, 199, 0.9) 26.06%, rgba(3, 64, 144, 0.9) 44.49%, rgba(1, 25, 59, 0.9) 82.21%, rgba(0, 4, 13, 0.9) 100%);
            border: 1px solid #494949;
            border-radius: 20px;
            backdrop-filter: blur(100px);
            z-index: 10;
            margin-top: 8px;
            overflow: hidden;
        }

        .subscription-dropdown-item {
            padding: 20px 30px;
            font-family: 'Onest';
            font-weight: 400;
            font-size: 20px;
            line-height: 1.5;
            letter-spacing: 2%;
            color: #FFFFFF;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .subscription-dropdown-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .subscription-dropdown-item.selected {
            background: rgba(5, 166, 245, 0.2);
        }

        .contacts-section {
            position: absolute;
            left: 50px;
            top: 520px;
            width: 770px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .contacts-title {
            position: absolute;
            left: 50px;
            top: 480px;
            font-family: 'Onest';
            font-weight: 400;
            font-size: 14px;
            line-height: 1.57;
            letter-spacing: 2%;
            color: #FFFFFF;
        }

        .slider-container {
            position: relative;
            width: 100%;
            height: 60px;
            padding: 20px 0;
            margin-bottom: 20px;
            margin-top: 40px;
        }

        .slider-track {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 66px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            transform: translateY(-50%);
            backdrop-filter: blur(100px);
        }

        .slider-track::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #00040D 0%, #01193B 17.79%, #034090 55.51%, #0168C7 73.94%, #05A6F5 95.79%);
            border-radius: 20px;
            width: var(--slider-progress, 0%);
            transition: width 0.1s ease;
        }

        .slider-thumb {
            position: absolute;
            top: 50%;
            width: 34px;
            height: 34px;
            background: #FFFFFF;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            box-shadow: 0px 0px 10px 0px rgba(0, 0, 0, 0.4);
            transition: box-shadow 0.2s ease, transform 0.1s ease;
            z-index: 3;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
        }

        .slider-thumb::before {
            content: url('data:image/svg+xml;utf8,<svg width="4" height="8" viewBox="0 0 4 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 1L1 4L3 7" stroke="%23006AFE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            display: flex;
            justify-content: center;
            align-items: center;
            width: 4px;
            height: 8px;
            margin-right: 4px;
        }

        .slider-thumb::after {
            content: url('data:image/svg+xml;utf8,<svg width="4" height="8" viewBox="0 0 4 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1L3 4L1 7" stroke="%23006AFE" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            display: flex;
            justify-content: center;
            align-items: center;
            width: 4px;
            height: 8px;
            margin-left: 4px;
        }
        
        .slider-thumb:hover {
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.35);
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        .slider-thumb:active {
            cursor: grabbing;
            transform: translate(-50%, -50%) scale(1.02);
        }

        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            padding: 0 20px;
        }

        .slider-label {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 18px;
            line-height: 1.44;
            letter-spacing: 2%;
            color: #FFFFFF;
        }

        .slider-value {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Onest';
            font-weight: 600;
            font-size: 16px;
            line-height: 1.5;
            letter-spacing: 2%;
            color: #034090;
            background: #FFFFFF;
            padding: 8px 16px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            white-space: nowrap;
            z-index: 4;
            border: none;
        }

        .slider-value::before {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid #FFFFFF;
        }

        .results-card {
            position: absolute;
            left: 870px;
            top: 184px;
            width: 360px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 14px;
            backdrop-filter: blur(150px);
            padding: 30px;
            box-shadow: inset 0px 0px 50px 0px rgba(255, 255, 255, 0.2);
        }

        .results-header {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 30px;
            line-height: 1.2;
            letter-spacing: -2%;
            color: #FFFFFF;
            margin-bottom: 30px;
            text-align: left;
        }

        .results-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
            margin-bottom: 35px;
        }

        .result-item {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }
        
        .result-item::before {
            content: '';
            width: 0;
            height: 26px;
            border-left: 6px solid #FFFFFF;
            flex-shrink: 0;
        }

        .result-icon {
            display: none;
        }

        .result-text {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 18px;
            line-height: 1.44;
            letter-spacing: 2%;
            color: #FFFFFF;
        }

        .budget-section {
            background: #FFFFFF;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }
        


        .budget-label {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 18px;
            line-height: 1.44;
            letter-spacing: 2%;
            color: #121212;
            margin-bottom: 12px;
        }

        .budget-value {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 30px;
            line-height: 1.2;
            letter-spacing: -2%;
            color: #121212;
            text-align: left;
        }

        .submit-button {
            background: #FFFFFF;
            border-radius: 50px;
            border: none;
            padding: 4px 14px 5px;
            width: 100%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .submit-text {
            font-family: 'IBM Plex Mono';
            font-weight: 400;
            font-size: 14px;
            line-height: 1.3;
            letter-spacing: 2%;
            color: #121212;
            text-transform: uppercase;
            text-align: center;
        }

        .hidden {
            display: none;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: #FFFFFF;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-family: 'Onest';
            font-weight: 600;
            font-size: 24px;
            color: #000000;
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            color: #000000;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s ease;
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        .modal-body {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .subscription-info h4 {
            font-family: 'Onest';
            font-weight: 600;
            font-size: 18px;
            color: #000000;
            margin: 0 0 10px 0;
        }

        .subscription-info p {
            font-family: 'Onest';
            font-weight: 400;
            font-size: 16px;
            line-height: 24px;
            color: #000000;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="background-blur"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Данные из Python калькулятора
        const SUBSCRIPTIONS = {
            1: "Target_pricing",
            2: "Retargeting pricing",
            3: "Колл-центр"
        };

        const SERVICE1_PRICING = [
            {contacts: 0, price_per_contact: 70},
            {contacts: 1000, price_per_contact: 60},
            {contacts: 3000, price_per_contact: 50},
            {contacts: 4000, price_per_contact: 45},
            {contacts: 5000, price_per_contact: 43},
            {contacts: 6000, price_per_contact: 40},
            {contacts: 7000, price_per_contact: 36},
            {contacts: 8000, price_per_contact: 34},
            {contacts: 9000, price_per_contact: 32},
            {contacts: 10000, price_per_contact: 30},
            {contacts: 13000, price_per_contact: 29},
            {contacts: 15000, price_per_contact: 28},
            {contacts: 20000, price_per_contact: 26},
            {contacts: 25000, price_per_contact: 25},
            {contacts: 30000, price_per_contact: 24},
            {contacts: 35000, price_per_contact: 23},
            {contacts: 40000, price_per_contact: 22},
            {contacts: 45000, price_per_contact: 21},
            {contacts: 50000, price_per_contact: 20}
        ];

        const SERVICE2_PRICING = [
            {contacts: 0, price_per_contact: 50},
            {contacts: 1000, price_per_contact: 45},
            {contacts: 3000, price_per_contact: 40},
            {contacts: 4000, price_per_contact: 38},
            {contacts: 5000, price_per_contact: 36},
            {contacts: 6000, price_per_contact: 34},
            {contacts: 7000, price_per_contact: 32},
            {contacts: 8000, price_per_contact: 30},
            {contacts: 9000, price_per_contact: 28},
            {contacts: 10000, price_per_contact: 26},
            {contacts: 13000, price_per_contact: 25},
            {contacts: 15000, price_per_contact: 24},
            {contacts: 20000, price_per_contact: 22},
            {contacts: 25000, price_per_contact: 21},
            {contacts: 30000, price_per_contact: 20},
            {contacts: 35000, price_per_contact: 19},
            {contacts: 40000, price_per_contact: 18},
            {contacts: 45000, price_per_contact: 17},
            {contacts: 50000, price_per_contact: 16}
        ];

        const SERVICE3_PRICING = [
            {contacts: 0, price_per_call: 50},
            {contacts: 1000, price_per_call: 45},
            {contacts: 3000, price_per_call: 40},
            {contacts: 4000, price_per_call: 35},
            {contacts: 5000, price_per_call: 34},
            {contacts: 6000, price_per_call: 33},
            {contacts: 7000, price_per_call: 32},
            {contacts: 8000, price_per_call: 31},
            {contacts: 9000, price_per_call: 30},
            {contacts: 10000, price_per_call: 29},
            {contacts: 13000, price_per_call: 28},
            {contacts: 15000, price_per_call: 27},
            {contacts: 20000, price_per_call: 26},
            {contacts: 25000, price_per_call: 25},
            {contacts: 30000, price_per_call: 24},
            {contacts: 35000, price_per_call: 23},
            {contacts: 40000, price_per_call: 22},
            {contacts: 45000, price_per_call: 21},
            {contacts: 50000, price_per_call: 20}
        ];

        const TECH_PACKAGES = {
            "Стандарт": {"price": 14900, "discount": 0.0},
            "Премиум": {"price": 24900, "discount": 0.05},
            "Бизнес": {"price": 49900, "discount": 0.1},
            "Call": {"price": 4990, "discount": 0.0}
        };

        function calculateCostByTiers(contacts, pricing) {
            let totalCost = 0;
            let remainingContacts = contacts;
            
            for (let i = 0; i < pricing.length; i++) {
                const tier = pricing[i];
                const nextTier = pricing[i + 1];
                
                // Определяем какое поле использовать для цены
                const priceField = tier.price_per_contact || tier.price_per_call;
                
                if (nextTier) {
                    const tierContacts = Math.min(remainingContacts, nextTier.contacts - tier.contacts);
                    totalCost += tierContacts * priceField;
                    remainingContacts -= tierContacts;
                    
                    if (remainingContacts <= 0) break;
                } else {
                    totalCost += remainingContacts * priceField;
                    break;
                }
            }
            
            return totalCost;
        }

        function getConversionRate(averageCheck, serviceType) {
            let baseRate;
            if (averageCheck < 100000) {
                baseRate = 0.03;  // 3%
            } else if (averageCheck >= 100000 && averageCheck < 3000000) {
                baseRate = 0.02;  // 2%
            } else {  // >= 3000000
                baseRate = 0.005;  // 0.5%
            }
            
            // Применяем множители для разных продуктов
            if (serviceType === 2) {  // Retargeting Trigger Leads
                return baseRate * 2;
            } else if (serviceType === 3) {  // Validation/Reactivation
                return baseRate * 3;
            }
            
            return baseRate;
        }

        function getServicePrice(serviceType, contacts, techPackage) {
            let pricing;
            if (serviceType === 1) {
                pricing = SERVICE1_PRICING;
            } else if (serviceType === 2) {
                pricing = SERVICE2_PRICING;
            } else {
                pricing = SERVICE3_PRICING;
            }
            
            const totalCost = calculateCostByTiers(contacts, pricing);
            
            let contactProcessingCost = 0;
            // Для tech подписки (Стандарт) обработка контакта не включается
            const isTechSubscription = techPackage === "Стандарт" && (serviceType === 1 || serviceType === 2);
            if ((serviceType === 1 || serviceType === 2) && !isTechSubscription) {
                contactProcessingCost = calculateCostByTiers(contacts, SERVICE3_PRICING);
            }
            
            const totalServiceCost = totalCost + contactProcessingCost;
            const packageInfo = TECH_PACKAGES[techPackage];
            const packageCost = packageInfo.price;
            const discount = packageInfo.discount;
            const discountedServiceCost = totalServiceCost * (1 - discount);
            const totalCostWithPackage = discountedServiceCost + packageCost;
            
            const contactCostWithSubscription = Math.round(totalCostWithPackage / contacts);
            
            return {
                totalCost,
                contactProcessingCost,
                totalServiceCost,
                packageCost,
                discount,
                totalCostWithPackage,
                contactCostWithSubscription
            };
        }

        function Calculator() {
            const [serviceType, setServiceType] = useState(1);
            const [contacts, setContacts] = useState(4500);
            const [averageCheck, setAverageCheck] = useState(100000);
            const [techPackage, setTechPackage] = useState("Стандарт");
            const [results, setResults] = useState(null);
            const [isDropdownOpen, setIsDropdownOpen] = useState(false);
            const [isSubscriptionDropdownOpen, setIsSubscriptionDropdownOpen] = useState(false);
            const [isModalOpen, setIsModalOpen] = useState(false);
            
            const serviceOptions = [
                { id: 1, name: "Segment_scoring" },
                { id: 2, name: "Retargeting Trigger Leads" },
                { id: 3, name: "Reactivation/Validation" }
            ];
            
            const subscriptionOptions = [
                { id: "tech", name: "Tech", package: "Стандарт" },
                { id: "must", name: "Must", package: "Премиум" },
                { id: "pro", name: "Pro", package: "Бизнес" },
                { id: "call", name: "Call", package: "Call" }
            ];

            useEffect(() => {
                calculateResults();
            }, [serviceType, contacts, averageCheck, techPackage]);

            const calculateResults = () => {
                const pricing = getServicePrice(serviceType, contacts, techPackage);
                const conversionRate = getConversionRate(averageCheck, serviceType);
                const expectedConversions = Math.round(contacts * conversionRate);
                const costPerConversion = pricing.totalCostWithPackage / expectedConversions;
                
                setResults({
                    ...pricing,
                    conversionRate,
                    expectedConversions,
                    costPerConversion,
                    isTechSubscription: techPackage === "Стандарт" && (serviceType === 1 || serviceType === 2)
                });
            };

            const formatNumber = (num) => {
                return new Intl.NumberFormat('ru-RU').format(Math.round(num));
            };

            const [isDragging, setIsDragging] = useState(false);
            
            const handleSliderChange = (e) => {
                const value = parseInt(e.target.value);
                setContacts(value);
            };
            
            const handleThumbMouseDown = (e) => {
                e.stopPropagation();
                setIsDragging(true);
            };
            
            const handleTrackClick = (e) => {
                updateSliderValue(e);
            };
            
            const handleMouseMove = (e) => {
                if (isDragging) {
                    updateSliderValue(e);
                }
            };
            
            const handleMouseUp = () => {
                setIsDragging(false);
            };
            
            const updateSliderValue = (e) => {
                const slider = e.currentTarget.closest ? e.currentTarget.closest('.slider-container') : e.currentTarget;
                const rect = slider.getBoundingClientRect();
                const percentage = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));
                const value = Math.round(1000 + percentage * (50000 - 1000));
                const steppedValue = Math.round(value / 100) * 100; // Round to nearest 100
                setContacts(Math.max(1000, Math.min(50000, steppedValue)));
            };
            
            useEffect(() => {
                if (isDragging) {
                    document.addEventListener('mousemove', handleMouseMove);
                    document.addEventListener('mouseup', handleMouseUp);
                    return () => {
                        document.removeEventListener('mousemove', handleMouseMove);
                        document.removeEventListener('mouseup', handleMouseUp);
                    };
                }
            }, [isDragging]);
            
            const toggleDropdown = () => {
                setIsDropdownOpen(!isDropdownOpen);
            };
            
            const selectService = (serviceId) => {
                setServiceType(serviceId);
                setIsDropdownOpen(false);
                
                // Автоматически устанавливаем подписку в зависимости от выбранной услуги
                if (serviceId === 3) {
                    // Для Reactivation/Validation автоматически устанавливаем Call
                    setTechPackage("Call");
                } else if (serviceId === 1 || serviceId === 2) {
                    // Для Segment Scoring и Retargeting Trigger Leads устанавливаем Tech по умолчанию
                    if (techPackage === "Call") {
                        setTechPackage("Стандарт");
                    }
                }
            };
            
            const getSelectedServiceName = () => {
                const selected = serviceOptions.find(option => option.id === serviceType);
                return selected ? selected.name : "Segment_scoring";
            };
            
            const toggleSubscriptionDropdown = () => {
                // Блокируем открытие dropdown для услуги Reactivation/Validation
                if (serviceType === 3) {
                    return;
                }
                
                // Разрешаем открытие только для услуг 1 и 2
                if (serviceType === 1 || serviceType === 2) {
                    setIsSubscriptionDropdownOpen(!isSubscriptionDropdownOpen);
                }
            };
            
            const toggleModal = () => {
                setIsModalOpen(!isModalOpen);
            };
            
            const selectSubscription = (subscriptionId) => {
                // Блокируем изменение подписки для услуги Reactivation/Validation
                if (serviceType === 3) {
                    setIsSubscriptionDropdownOpen(false);
                    return;
                }
                
                const selected = subscriptionOptions.find(option => option.id === subscriptionId);
                if (selected) {
                    // Разрешаем выбор только tech, must, pro для услуг 1 и 2
                    if ((serviceType === 1 || serviceType === 2) && selected.id !== 'call') {
                        setTechPackage(selected.package);
                    }
                }
                setIsSubscriptionDropdownOpen(false);
            };
            
            const getSelectedSubscriptionName = () => {
                const selected = subscriptionOptions.find(option => option.package === techPackage);
                return selected ? selected.name : "Tech";
            };

            return (
                <div className="calculator-container">
                    <div className="header">
                        <h1>Калькулятор стоимости</h1>
                        <p>Рассчитайте бюджет, охват и конверсию в лиды</p>
                    </div>

                    <div className="disclaimer">
                        *расчет стоимости носит примерный ознакомительный характер. Точный бюджет предоставит ваш персональный менеджер
                    </div>

                    <div className="product-section">
                        <div className="section-title" style={{display: 'flex', alignItems: 'center', gap: '8px'}}>
                            Выберите продукт
                            <svg className="info-icon" onClick={toggleModal} viewBox="0 0 16 16" style={{width: '16px', height: '16px', cursor: 'pointer', fill: '#FFFFFF'}}>
                                <path d="M8 0C3.6 0 0 3.6 0 8s3.6 8 8 8 8-3.6 8-8-3.6-8-8-8zm1 12H7V7h2v5zm0-6H7V4h2v2z"/>
                            </svg>
                        </div>
                        <div className="product-selector" onClick={toggleDropdown}>
                            <div className="product-name">{getSelectedServiceName()}</div>
                            <svg className={`dropdown-arrow ${isDropdownOpen ? 'open' : ''}`} viewBox="0 0 12 6">
                                <path d="M1 1L6 5L11 1" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                        </div>
                        {isDropdownOpen && (
                            <div className="dropdown-menu">
                                {serviceOptions.map(option => (
                                    <div 
                                        key={option.id}
                                        className={`dropdown-item ${serviceType === option.id ? 'selected' : ''}`}
                                        onClick={() => selectService(option.id)}
                                    >
                                        {option.name}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <div className="average-check-section">
                        <div className="section-title">Средний чек продажи (руб)</div>
                        <div className="input-container">
                            <input 
                                type="text" 
                                className="input-field"
                                value={averageCheck ? formatNumber(averageCheck) : ''}
                                onChange={(e) => {
                                    const value = e.target.value.replace(/\D/g, '');
                                    setAverageCheck(parseInt(value) || 0);
                                }}
                                placeholder="Введите сумму в рублях |"
                            />
                        </div>
                    </div>

                    <div className="subscription-section">
                        <div className="section-title">Введите тип подписки</div>
                        <div 
                            className={`subscription-selector ${serviceType === 3 ? 'disabled' : ''}`} 
                            onClick={toggleSubscriptionDropdown}
                            style={{
                                opacity: serviceType === 3 ? 0.6 : 1,
                                cursor: serviceType === 3 ? 'not-allowed' : 'pointer'
                            }}
                        >
                            <div className="subscription-value">{getSelectedSubscriptionName()}</div>
                            <svg className={`dropdown-arrow ${isSubscriptionDropdownOpen ? 'open' : ''}`} viewBox="0 0 12 6">
                                <path d="M1 1L6 5L11 1" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                            </svg>
                        </div>
                        {isSubscriptionDropdownOpen && (
                            <div className="subscription-dropdown-menu">
                                {subscriptionOptions
                                    .filter(option => {
                                        // Показываем только tech, must, pro для услуг 1 и 2
                                        if (serviceType === 1 || serviceType === 2) {
                                            return option.id !== 'call';
                                        }
                                        return true;
                                    })
                                    .map(option => (
                                        <div 
                                            key={option.id}
                                            className={`subscription-dropdown-item ${techPackage === option.package ? 'selected' : ''}`}
                                            onClick={() => selectSubscription(option.id)}
                                        >
                                            {option.name}
                                        </div>
                                    ))
                                }
                            </div>
                        )}
                    </div>

                    <div className="contacts-title">Выберите количество контактов</div>
                    <div className="contacts-section">
                        <div 
                            className="slider-container"
                            onClick={handleTrackClick}
                            style={{
                                userSelect: 'none'
                            }}
                        >
                            <div 
                                className="slider-track"
                                style={{
                                    '--slider-progress': `${((contacts - 1000) / (50000 - 1000)) * 100}%`
                                }}
                            ></div>
                            <input 
                                type="range" 
                                min="1000" 
                                max="50000" 
                                step="100"
                                value={contacts}
                                onChange={handleSliderChange}
                                style={{
                                    position: 'absolute',
                                    width: '100%',
                                    height: '100%',
                                    opacity: 0,
                                    cursor: 'pointer',
                                    pointerEvents: 'none'
                                }}
                            />
                            <div 
                                className="slider-thumb" 
                                style={{
                                    left: `${((contacts - 1000) / (50000 - 1000)) * 100}%`,
                                    cursor: isDragging ? 'grabbing' : 'grab'
                                }}
                                onMouseDown={handleThumbMouseDown}
                            ></div>
                            <div 
                                className="slider-value"
                                style={{
                                    left: `${((contacts - 1000) / (50000 - 1000)) * 100}%`
                                }}
                            >{formatNumber(contacts)}</div>
                        </div>
                        <div className="slider-labels">
                            <span className="slider-label">1000</span>
                            <span className="slider-label">25 000</span>
                            <span className="slider-label">50 000</span>
                        </div>
                    </div>

                    {results && (
                        <div className="results-card">
                            <div className="results-header">{results.expectedConversions} лида (SQL)</div>
                            
                            <div className="results-list">
                                <div className="result-item">
                                    <svg className="result-icon" viewBox="0 0 16 16">
                                        <circle cx="8" cy="8" r="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                    <span className="result-text">Прогноз конверсии: {(results.conversionRate * 100).toFixed(1)}%</span>
                                </div>
                                
                                <div className="result-item">
                                    <svg className="result-icon" viewBox="0 0 16 16">
                                        <circle cx="8" cy="8" r="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                    <span className="result-text">Стоимость данных: {Math.round(results.totalCost / contacts)}₽/ед</span>
                                </div>
                                
                                {(serviceType === 1 || serviceType === 2) && (
                                    <div className="result-item">
                                        <svg className="result-icon" viewBox="0 0 16 16">
                                            <circle cx="8" cy="8" r="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                        <span className="result-text">
                                            Обработка контакта: {results.isTechSubscription ? "не включено" : `${Math.round(results.contactProcessingCost / contacts)}₽/ед`}
                                        </span>
                                    </div>
                                )}
                                
                                <div className="result-item">
                                    <svg className="result-icon" viewBox="0 0 16 16">
                                        <circle cx="8" cy="8" r="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                    <span className="result-text">Подписка: {formatNumber(results.packageCost)} ₽</span>
                                </div>
                                
                                <div className="result-item">
                                    <svg className="result-icon" viewBox="0 0 16 16">
                                        <circle cx="8" cy="8" r="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
                                    </svg>
                                    <span className="result-text">Стоимость лида: {formatNumber(results.costPerConversion)} ₽/ед</span>
                                </div>
                            </div>
                            
                            <div className="budget-section">
                                <div className="budget-label">Бюджет:</div>
                                <div className="budget-value">{formatNumber(results.totalCostWithPackage)} ₽</div>
                            </div>
                            
                            <button className="submit-button">
                                <span className="submit-text">ВЫБРАТЬ</span>
                            </button>
                        </div>
                    )}

                    {isModalOpen && (
                        <div className="modal-overlay" onClick={toggleModal}>
                            <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                                <div className="modal-header">
                                    <h3>Информация о услугах</h3>
                                    <button className="modal-close" onClick={toggleModal}>
                                        <svg viewBox="0 0 24 24" width="24" height="24">
                                            <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
                                        </svg>
                                    </button>
                                </div>
                                <div className="modal-body">
                                    <div className="subscription-info">
                                        <h4>Retargeting Trigger Leads</h4>
                                        <p>Идентифицирует скрытых посетителей на конкретных страницах сайтов рекламодателя через лёгкий JS-код, фиксирующий geo, источник визита, устройство, время и поведение на страницах. Сопоставляет данные с Big Data Reffection и создаёт уникальный профиль пользователя. Определяет триггеры (поведенческие сигналы), которые показывают, насколько клиент готов к покупке — и возвращает его в воронку продаж.</p>
                                    </div>
                                    <div className="subscription-info">
                                        <h4>Segment Scoring</h4>
                                        <p>Собирает данные на сайтах в нише рекламодателя, анализируя цифровой след пользователей через Big Data, DMP Reffection и ML-модели телеком-операторов. Определяет вероятностный уровень вовлечённости и платёжеспособности клиента, учитывая геолокацию, поведение в сети, звонковую активность и контентное потребление.</p>
                                    </div>
                                    <div className="subscription-info">
                                        <h4>Reactivation/Validation</h4>
                                        <p>Дозванивается до 90% клиентов, используя технологии обхода спам-фильтров и адаптивную телефонию. Сценарии разговоров адаптированы под вашу нишу — операторы обучены продукту. Фильтрует, квалифицирует и возвращает до 50% потерянных лидов обратно в воронку продаж.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<Calculator />, document.getElementById('root'));
    </script>
</body>
</html>